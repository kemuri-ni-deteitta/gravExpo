{% extends 'partials/base.html.twig' %}

{% block content %}
    {{ page.content|raw }}
    
    {% if page.header.phones or page.header.address or page.header.email %}
    <div class="contact-info-section">
        <h2>–ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h2>
        
        {% if page.header.address %}
        <div class="contact-item">
            <h3>–ê–¥—Ä–µ—Å</h3>
            <p><strong>{{ page.header.address }}</strong></p>
        </div>
        {% endif %}
        
        {% if page.header.phones %}
        <div class="contact-item">
            <h3>–¢–µ–ª–µ—Ñ–æ–Ω—ã</h3>
            <ul class="phone-list">
                {% for phone in page.header.phones %}
                <li>
                    <strong>{{ phone.number }}</strong>
                    {% if phone.description %}
                    <span class="phone-description"> - {{ phone.description }}</span>
                    {% endif %}
                </li>
                {% endfor %}
            </ul>
        </div>
        {% endif %}
        
        {% if page.header.email %}
        <div class="contact-item">
            <h3>–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –ø–æ—á—Ç–∞</h3>
            <p><a href="mailto:{{ page.header.email }}"><strong>{{ page.header.email }}</strong></a></p>
        </div>
        {% endif %}
    </div>
    {% endif %}
    
    {# Yandex Map section - using reliable widget approach #}
    {% if page.header.address %}
    <div class="map-section">
        <h2>–ö–∞–∫ –Ω–∞—Å –Ω–∞–π—Ç–∏</h2>
        <div id="yandex-map" style="position:relative;overflow:hidden;width:100%;height:400px;background:#f5f5f5;border:1px solid #ddd;display:flex;align-items:center;justify-content:center;">
            <div style="text-align:center;color:#666;">
                <div style="font-size:48px;margin-bottom:10px;">üó∫Ô∏è</div>
                <div style="font-size:18px;margin-bottom:5px;"><strong>–ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ä—Ç—ã...</strong></div>
                <div style="font-size:14px;">{{ page.header.address }}</div>
            </div>
        </div>
        
        <script type="text/javascript">
            // Use coordinates from admin panel for precise map location
            var address = "{{ page.header.address }}";
            var coordinates = "{{ page.header.coordinates }}";
            var mapContainer = document.getElementById('yandex-map');
            
            // Parse coordinates - format should be "latitude,longitude" for Yandex Maps
            var coords = coordinates.split(',');
            var latitude = coords[0].trim();
            var longitude = coords[1].trim();
            
            // Create a working Yandex Maps widget with coordinates from admin panel
            var iframe = document.createElement('iframe');
            iframe.src = 'https://yandex.ru/map-widget/v1/?ll=' + longitude + ',' + latitude + '&z=17&l=map&pt=' + longitude + ',' + latitude + ',pm2rdm&source=constructor';
            iframe.width = '100%';
            iframe.height = '400';
            iframe.frameBorder = '0';
            iframe.style.border = '0';
            iframe.allowFullscreen = true;
            
            // Clear loading content and add iframe
            mapContainer.innerHTML = '';
            mapContainer.style.background = 'none';
            mapContainer.style.border = 'none';
            mapContainer.appendChild(iframe);
            
            // Add a note about the address
            var addressNote = document.createElement('div');
            addressNote.style.cssText = 'margin-top:10px;padding:10px;background:#f0f8ff;border-left:3px solid #0066cc;font-size:12px;color:#666;';
            addressNote.innerHTML = '<strong>–ê–¥—Ä–µ—Å –∫–æ–º–ø–∞–Ω–∏–∏:</strong> ' + address + '<br><small>–ö–∞—Ä—Ç–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–æ—á–Ω–æ–µ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏ –ø–æ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º: ' + coordinates + '</small>';
            mapContainer.appendChild(addressNote);
            
            // Add direct link to Yandex Maps with coordinates
            var directLink = document.createElement('div');
            directLink.style.cssText = 'margin-top:10px;text-align:center;';
            var link = document.createElement('a');
            link.href = 'https://yandex.ru/maps/?ll=' + longitude + ',' + latitude + '&z=17&l=map&pt=' + longitude + ',' + latitude + ',pm2rdm&text=' + encodeURIComponent(address);
            link.target = '_blank';
            link.style.cssText = 'color:#0066cc;text-decoration:none;font-weight:bold;';
            link.textContent = 'üîç –û—Ç–∫—Ä—ã—Ç—å –≤ –Ø–Ω–¥–µ–∫—Å –ö–∞—Ä—Ç–∞—Ö';
            directLink.appendChild(link);
            mapContainer.appendChild(directLink);
        </script>
        <p class="map-note"><em>–ö–∞—Ä—Ç–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∞–¥—Ä–µ—Å: {{ page.header.address }}</em></p>
    </div>
    {% endif %}
{% endblock %} 